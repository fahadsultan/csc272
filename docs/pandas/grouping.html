<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Grouping</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../style.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-syllabus" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Syllabus</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-syllabus">    
        <li>
    <a class="dropdown-item" href="../syllabus/about.html">
 <span class="dropdown-text">Course Description and Goals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/grading.html">
 <span class="dropdown-text">Grading</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/academic_success.html">
 <span class="dropdown-text">Center for Academic Success</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/textbook.html">
 <span class="dropdown-text">Textbooks &amp; Other Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/integrity.html">
 <span class="dropdown-text">Academic Integrity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/mental_health.html">
 <span class="dropdown-text">Mental Health Resources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/accomodations.html">
 <span class="dropdown-text">Accomodations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../syllabus/title_9.html">
 <span class="dropdown-text">Nondiscrimination Policy and Sexual Misconduct</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../project/project.html"> 
<span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../project/data.html"> 
<span class="menu-text">Datasets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://courses.furman.edu/course/view.php?id=20763"> 
<span class="menu-text">Moodle Page</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus/appointment.html"> 
<span class="menu-text">Office Hours</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://calendly.com/ssultan-dpq/"> 
<span class="menu-text">Set an Appointment</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../pandas/grouping.html">Grouping</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/preliminaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Flat vs.&nbsp;Hierarchical Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/read_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reading Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/linalg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scalars, Vectors and Matrices</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/view_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Index and Columns</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vectorized Operations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/select_filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selection, Filtering and Dropping</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Selection: subset of columns</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Filtering: subset of rows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/extraction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extracting and Dropping values</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats/summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Descriptive Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stats/correlations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Covariance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/write_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writing Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/concat_merge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concatenation and Merging</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/grouping.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Grouping</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/pivot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pivot table</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../pandas/apply.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Applying custom functions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualizing Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/anatomy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anatomy of a Plot</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/lineplots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Line Plots (Temporal Data)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/scatter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scatter Plots (<span class="math inline">\(\geq\)</span> 2 numeric variables)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plotting/boxplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Box Plots</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../encoding/encoding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Encoding</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../encoding/types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Feature Types</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../encoding/text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../encoding/network.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Networks Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../encoding/sound.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Audio Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../encoding/images.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Image Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../encoding/spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geospatial Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../encoding/time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linearalgebra/vectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geometric Interpretation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linearalgebra/matrices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matrices</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../linearalgebra/nearestneighbor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nearest Neighbor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../probability/probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../probability/joint_prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Joint Probability</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../probability/conditional_prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional Probability</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../probability/naivebayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Naive Bayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../beyond/gc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Garbage Collection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../beyond/sklearn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scikit-learn</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../beyond/41_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../beyond/21_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../beyond/42_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#aggregation-with-.groupby" id="toc-aggregation-with-.groupby" class="nav-link active" data-scroll-target="#aggregation-with-.groupby">Aggregation with <code>.groupby</code></a>
  <ul class="collapse">
  <li><a href="#aggregation-with-lambda-functions" id="toc-aggregation-with-lambda-functions" class="nav-link" data-scroll-target="#aggregation-with-lambda-functions">Aggregation with <code>lambda</code> Functions</a></li>
  <li><a href="#other-groupby-features" id="toc-other-groupby-features" class="nav-link" data-scroll-target="#other-groupby-features">Other <code>GroupBy</code> Features</a></li>
  <li><a href="#filtering-by-group" id="toc-filtering-by-group" class="nav-link" data-scroll-target="#filtering-by-group">Filtering by Group</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Grouping</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="aggregation-with-.groupby" class="level2">
<h2 class="anchored" data-anchor-id="aggregation-with-.groupby">Aggregation with <code>.groupby</code></h2>
<p>Up until this point, we have been working with individual rows of DataFrames. As data scientists, we often wish to investigate trends across a larger subset of our data. For example, we may want to compute some summary statistic (the mean, median, sum, etc.) for a group of rows in our DataFrame. To do this, we’ll use pandas GroupBy objects.</p>
<center>
<img src="https://pandas.pydata.org/docs/_images/06_groupby.svg" alt="groupby" width="95%" style="filter:invert(1)">
</center>
<center>
<img src="https://pandas.pydata.org/docs/_images/06_valuecounts.svg" alt="groupby" width="95%" style="filter:invert(1)">
</center>
<center>
<img src="https://i.ibb.co/y0P3GXq/groupby1.png" alt="groupby" width="95%" style="filter:invert(1)">
</center>
<p>A groupby operation involves some combination of <strong>splitting a DataFrame into grouped subframes</strong>, <strong>applying a function</strong>, and <strong>combining the results</strong>.</p>
<p>For some arbitrary DataFrame <code>df</code> below, the code <code>df.groupby("year").sum()</code> does the following:</p>
<ul>
<li><strong>Splits</strong> the DataFrame into sub-DataFrames with rows belonging to the same year.</li>
<li><strong>Applies</strong> the <code>sum</code> function to each column of each sub-DataFrame.</li>
<li><strong>Combines</strong> the results of <code>sum</code> into a single DataFrame, indexed by <code>year</code>.</li>
</ul>
<center>
<img src="https://i.ibb.co/mNCGC62/groupby-demo.png" alt="groupby_demo" width="80%" style="filter:invert(1)">
</center>
<p>Let’s say we had baby names for all years in a single DataFrame <code>names</code></p>
<div id="cell-2" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Download data from the web directly</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">"https://www.ssa.gov/oact/babynames/names.zip"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>local_filename <span class="op">=</span> <span class="st">"../data/names.zip"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(local_filename): <span class="co"># if the data exists don't download again</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> urllib.request.urlopen(data_url) <span class="im">as</span> resp, <span class="bu">open</span>(local_filename, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        f.write(resp.read())</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data without unzipping the file</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> [] </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> zipfile.ZipFile(local_filename, <span class="st">"r"</span>) <span class="im">as</span> zf:</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    data_files <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> zf.filelist <span class="cf">if</span> f.filename[<span class="op">-</span><span class="dv">3</span>:] <span class="op">==</span> <span class="st">"txt"</span>]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_year_from_filename(fn):</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">int</span>(fn[<span class="dv">3</span>:<span class="dv">7</span>])</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> data_files:</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        year <span class="op">=</span> extract_year_from_filename(f.filename)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> zf.<span class="bu">open</span>(f) <span class="im">as</span> fp:</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(fp, names<span class="op">=</span>[<span class="st">"Name"</span>, <span class="st">"Sex"</span>, <span class="st">"Count"</span>])</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"Year"</span>] <span class="op">=</span> year</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            names.append(df)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> pd.concat(names)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Mary</td>
<td>F</td>
<td>7065</td>
<td>1880</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Anna</td>
<td>F</td>
<td>2604</td>
<td>1880</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Emma</td>
<td>F</td>
<td>2003</td>
<td>1880</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Elizabeth</td>
<td>F</td>
<td>1939</td>
<td>1880</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Minnie</td>
<td>F</td>
<td>1746</td>
<td>1880</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31677</td>
<td>Zyell</td>
<td>M</td>
<td>5</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31678</td>
<td>Zyen</td>
<td>M</td>
<td>5</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31679</td>
<td>Zymirr</td>
<td>M</td>
<td>5</td>
<td>2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31680</td>
<td>Zyquan</td>
<td>M</td>
<td>5</td>
<td>2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31681</td>
<td>Zyrin</td>
<td>M</td>
<td>5</td>
<td>2023</td>
</tr>
</tbody>
</table>

<p>2117219 rows × 4 columns</p>
</div>
</div>
</div>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>names.to_csv(<span class="st">"../data/names.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, if we wanted to aggregate all rows in <code>names</code> for a given year, we would need <code>names.groupby("Year")</code></p>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>names.groupby(<span class="st">"Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7f7a30b64bb0&gt;</code></pre>
</div>
</div>
<p>What does this strange output mean? Calling <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html"><code>.groupby</code></a> has generated a <code>GroupBy</code> object. You can imagine this as a set of “mini” sub-DataFrames, where each subframe contains all of the rows from <code>names</code> that correspond to a particular year.</p>
<p>The diagram below shows a simplified view of <code>names</code> to help illustrate this idea.</p>
<center>
<img src="../assets/gb.png" alt="groupby" width="95%" style="filter:invert(1)">
</center>
<p>We can’t work with a <code>GroupBy</code> object directly – that is why you saw that strange output earlier, rather than a standard view of a DataFrame. To actually manipulate values within these “mini” DataFrames, we’ll need to call an <em>aggregation method</em>. This is a method that tells <code>pandas</code> how to aggregate the values within the <code>GroupBy</code> object. Once the aggregation is applied, <code>pandas</code> will return a normal (now grouped) DataFrame.</p>
<p>Aggregation functions (<code>.min()</code>, <code>.max()</code>, <code>.mean()</code>, <code>.sum()</code>, etc.) are the most common way to work with <code>GroupBy</code> objects. These functions are applied to each column of a “mini” grouped DataFrame. We end up with a new DataFrame with one aggregated row per subframe. Let’s see this in action by finding the <code>sum</code> of all counts for each year in <code>names</code> – this is equivalent to finding the number of babies born in each year.</p>
<div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>names.groupby(<span class="st">"Year"</span>).<span class="bu">sum</span>().head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1880</td>
<td>201484</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1881</td>
<td>192690</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1882</td>
<td>221533</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1883</td>
<td>216944</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1884</td>
<td>243461</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can relate this back to the diagram we used above. Remember that the diagram uses a simplified version of <code>names</code>, which is why we see smaller values for the summed counts.</p>
<!-- ![Performing an aggregation](https://raw.githubusercontent.com/fahadsultan/csc272/main/assets/agg.png) -->
<center>
<img src="https://raw.githubusercontent.com/fahadsultan/csc272_s23/main/assets/agg.png&quot;" alt="groupby" width="95%" style="filter:invert(1)">
</center>
<p>Calling <code>.agg</code> has condensed each subframe back into a single row. This gives us our final output: a DataFrame that is now indexed by <code>"Year"</code>, with a single row for each unique year in the original <code>names</code> DataFrame.</p>
<p>You may be wondering: where did the <code>"State"</code>, <code>"Sex"</code>, and <code>"Name"</code> columns go? Logically, it doesn’t make sense to <code>sum</code> the string data in these columns (how would we add “Mary” + “Ann”?). Because of this, <code>pandas</code> will simply omit these columns when it performs the aggregation on the DataFrame. Since this happens implicitly, without the user specifying that these columns should be ignored, it’s easy to run into troubling situations where columns are removed without the programmer noticing. It is better coding practice to select <em>only</em> the columns we care about before performing the aggregation.</p>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same result, but now we explicitly tell pandas to only consider the "Count" column when summing</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>names.groupby(<span class="st">"Year"</span>)[[<span class="st">"Count"</span>]].<span class="bu">sum</span>().head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1880</td>
<td>201484</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1881</td>
<td>192690</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1882</td>
<td>221533</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1883</td>
<td>216944</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1884</td>
<td>243461</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There are many different aggregations that can be applied to the grouped data. The primary requirement is that an aggregation function must:</p>
<ul>
<li>Take in a <code>Series</code> of data (a single column of the grouped subframe)</li>
<li>Return a single value that aggregates this <code>Series</code></li>
</ul>
<p>Because of this fairly broad requirement, <code>pandas</code> offers many ways of computing an aggregation.</p>
<p><strong>In-built</strong> Python operations – such as <code>sum</code>, <code>max</code>, and <code>min</code> – are automatically recognized by <code>pandas</code>.</p>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the maximum count for each name in any year?</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>names.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].<span class="bu">max</span>().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaban</td>
<td>16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabha</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabid</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabidah</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabir</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the minimum count for each name in any year?</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>names.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].<span class="bu">min</span>().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaban</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabha</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabid</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabidah</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabir</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the average count for each name across all years?</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>names.groupby(<span class="st">"Name"</span>)[[<span class="st">"Count"</span>]].mean().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaban</td>
<td>10.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabha</td>
<td>6.375000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabid</td>
<td>5.333333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabidah</td>
<td>5.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabir</td>
<td>5.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><code>pandas</code> also offers a number of in-built functions for aggregation. Some examples include:</p>
<ul>
<li><code>.sum()</code></li>
<li><code>.max()</code></li>
<li><code>.min()</code></li>
<li><code>.mean()</code></li>
<li><code>.first()</code></li>
<li><code>.last()</code></li>
</ul>
<p>The latter two entries in this list – <code>"first"</code> and <code>"last"</code> – are unique to <code>pandas</code>. They return the first or last entry in a subframe column. Why might this be useful? Consider a case where <em>multiple</em> columns in a group share identical information. To represent this information in the grouped output, we can simply grab the first or last entry, which we know will be identical to all other entries.</p>
<p>Let’s illustrate this with an example. Say we add a new column to <code>names</code> that contains the first letter of each name.</p>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imagine we had an additional column, "First Letter". We'll explain this code next week</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>names[<span class="st">"First Letter"</span>] <span class="op">=</span> names[<span class="st">"Name"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">0</span>])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We construct a simplified DataFrame containing just a subset of columns</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>names_new <span class="op">=</span> names[[<span class="st">"Name"</span>, <span class="st">"First Letter"</span>, <span class="st">"Year"</span>]]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>names_new.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">First Letter</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Mary</td>
<td>M</td>
<td>1880</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Anna</td>
<td>A</td>
<td>1880</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Emma</td>
<td>E</td>
<td>1880</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Elizabeth</td>
<td>E</td>
<td>1880</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Minnie</td>
<td>M</td>
<td>1880</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>If we form groups for each name in the dataset, <code>"First Letter"</code> will be the same for all members of the group. This means that if we simply select the first entry for <code>"First Letter"</code> in the group, we’ll represent all data in that group.</p>
<p>We can use a dictionary to apply different aggregation functions to each column during grouping.</p>
<!-- ![Aggregating using "first"](../assets/first.png) -->
<center>
<img src="../assets/first.png" alt="first" width="100%" style="filter:invert(1)">
</center>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>names_new.groupby(<span class="st">"Name"</span>).agg({<span class="st">"First Letter"</span>:<span class="st">"first"</span>, <span class="st">"Year"</span>:<span class="st">"max"</span>}).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">First Letter</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaban</td>
<td>A</td>
<td>2019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabha</td>
<td>A</td>
<td>2021</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabid</td>
<td>A</td>
<td>2018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabidah</td>
<td>A</td>
<td>2018</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabir</td>
<td>A</td>
<td>2018</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can also define aggregation functions of our own! This can be done using either a <code>def</code> or <code>lambda</code> statement. Again, the condition for a custom aggregation function is that it must take in a <code>Series</code> and output a single scalar value.</p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ratio_to_peak(series):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series.iloc[<span class="op">-</span><span class="dv">1</span>]<span class="op">/</span><span class="bu">max</span>(series)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>names.groupby(<span class="st">"Name"</span>)[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].<span class="bu">apply</span>(ratio_to_peak)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>

<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)

Input <span class="ansi-green-fg">In [2]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 4&gt;</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">ratio_to_peak</span>(series):

<span class="ansi-green-fg ansi-bold">      2</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> series<span style="color:rgb(98,98,98)">.</span>iloc[<span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>]<span style="color:rgb(98,98,98)">/</span><span style="color:rgb(0,135,0)">max</span>(series)

<span class="ansi-green-fg">----&gt; 4</span> <span class="ansi-yellow-bg">names</span><span style="color:rgb(98,98,98)">.</span>groupby(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Name</span><span style="color:rgb(175,0,0)">"</span>)[[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Year</span><span style="color:rgb(175,0,0)">"</span>, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Count</span><span style="color:rgb(175,0,0)">"</span>]]<span style="color:rgb(98,98,98)">.</span>apply(ratio_to_peak)



<span class="ansi-red-fg">NameError</span>: name 'names' is not defined</pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>lambda</code> functions are a special type of function that can be defined in a single line. They are also often refered to as <em>“anonymous”</em> functions because these functions don’t have a name. They are useful for simple functions that are not used elsewhere in your code.</p>
</div>
</div>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, using lambda</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>names.groupby(<span class="st">"Name"</span>)[[<span class="st">"Year"</span>, <span class="st">"Count"</span>]].agg(<span class="kw">lambda</span> s: s.iloc[<span class="op">-</span><span class="dv">1</span>]<span class="op">/</span><span class="bu">max</span>(s))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aaban</td>
<td>1.0</td>
<td>0.375000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabha</td>
<td>1.0</td>
<td>0.555556</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabid</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aabidah</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aabir</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zyvion</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zyvon</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zyyanna</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zyyon</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zzyzx</td>
<td>1.0</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

<p>101338 rows × 2 columns</p>
</div>
</div>
</div>
<section id="aggregation-with-lambda-functions" class="level3">
<h3 class="anchored" data-anchor-id="aggregation-with-lambda-functions">Aggregation with <code>lambda</code> Functions</h3>
<p>We’ll work with the <code>elections</code> DataFrame again.</p>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/fahadsultan/csc272/main/data/elections.csv"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>elections <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>elections.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>Democratic-Republican</td>
<td>151271</td>
<td>loss</td>
<td>57.210122</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>Democratic-Republican</td>
<td>113142</td>
<td>win</td>
<td>42.789878</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1828</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>642806</td>
<td>win</td>
<td>56.203927</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1828</td>
<td>John Quincy Adams</td>
<td>National Republican</td>
<td>500897</td>
<td>loss</td>
<td>43.796073</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1832</td>
<td>Andrew Jackson</td>
<td>Democratic</td>
<td>702735</td>
<td>win</td>
<td>54.574789</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What if we wish to aggregate our DataFrame using a non-standard function – for example, a function of our own design? We can do so by combining <code>.agg</code> with <code>lambda</code> expressions.</p>
<p>Let’s first consider a puzzle to jog our memory. We will attempt to find the <code>Candidate</code> from each <code>Party</code> with the highest <code>%</code> of votes.</p>
<p>A naive approach may be to group by the <code>Party</code> column and aggregate by the maximum.</p>
<div id="cell-25" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>elections.groupby(<span class="st">"Party"</span>).agg(<span class="bu">max</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">American</td>
<td>1976</td>
<td>Thomas J. Anderson</td>
<td>873053</td>
<td>loss</td>
<td>21.554001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">American Independent</td>
<td>1976</td>
<td>Lester Maddox</td>
<td>9901118</td>
<td>loss</td>
<td>13.571218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Anti-Masonic</td>
<td>1832</td>
<td>William Wirt</td>
<td>100715</td>
<td>loss</td>
<td>7.821583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Anti-Monopoly</td>
<td>1884</td>
<td>Benjamin Butler</td>
<td>134294</td>
<td>loss</td>
<td>1.335838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Citizens</td>
<td>1980</td>
<td>Barry Commoner</td>
<td>233052</td>
<td>loss</td>
<td>0.270182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Communist</td>
<td>1932</td>
<td>William Z. Foster</td>
<td>103307</td>
<td>loss</td>
<td>0.261069</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Constitution</td>
<td>2016</td>
<td>Michael Peroutka</td>
<td>203091</td>
<td>loss</td>
<td>0.152398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Constitutional Union</td>
<td>1860</td>
<td>John Bell</td>
<td>590901</td>
<td>loss</td>
<td>12.639283</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Democratic</td>
<td>2020</td>
<td>Woodrow Wilson</td>
<td>81268924</td>
<td>win</td>
<td>61.344703</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Democratic-Republican</td>
<td>1824</td>
<td>John Quincy Adams</td>
<td>151271</td>
<td>win</td>
<td>57.210122</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This approach is clearly wrong – the DataFrame claims that Woodrow Wilson won the presidency in 2020.</p>
<p>Why is this happening? Here, the <code>max</code> aggregation function is taken over every column <em>independently</em>. Among Democrats, <code>max</code> is computing:</p>
<ul>
<li>The most recent <code>Year</code> a Democratic candidate ran for president (2020)</li>
<li>The <code>Candidate</code> with the alphabetically “largest” name (“Woodrow Wilson”)</li>
<li>The <code>Result</code> with the alphabetically “largest” outcome (“win”)</li>
</ul>
<p>Instead, let’s try a different approach. We will:</p>
<ol type="1">
<li>Sort the DataFrame so that rows are in descending order of <code>%</code></li>
<li>Group by <code>Party</code> and select the first row of each sub-DataFrame</li>
</ol>
<p>While it may seem unintuitive, sorting <code>elections</code> by descending order of <code>%</code> is extremely helpful. If we then group by <code>Party</code>, the first row of each groupby object will contain information about the <code>Candidate</code> with the highest voter <code>%</code>.</p>
<div id="cell-27" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent <span class="op">=</span> elections.sort_values(<span class="st">"%"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">114</td>
<td>1964</td>
<td>Lyndon Johnson</td>
<td>Democratic</td>
<td>43127041</td>
<td>win</td>
<td>61.344703</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">91</td>
<td>1936</td>
<td>Franklin Roosevelt</td>
<td>Democratic</td>
<td>27752648</td>
<td>win</td>
<td>60.978107</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">120</td>
<td>1972</td>
<td>Richard Nixon</td>
<td>Republican</td>
<td>47168710</td>
<td>win</td>
<td>60.907806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">79</td>
<td>1920</td>
<td>Warren Harding</td>
<td>Republican</td>
<td>16144093</td>
<td>win</td>
<td>60.574501</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">133</td>
<td>1984</td>
<td>Ronald Reagan</td>
<td>Republican</td>
<td>54455472</td>
<td>win</td>
<td>59.023326</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>elections_sorted_by_percent.groupby(<span class="st">"Party"</span>).agg(<span class="kw">lambda</span> x : x.iloc[<span class="dv">0</span>]).head(<span class="dv">10</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalent to the below code</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># elections_sorted_by_percent.groupby("Party").agg('first').head(10)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">American</td>
<td>1856</td>
<td>Millard Fillmore</td>
<td>873053</td>
<td>loss</td>
<td>21.554001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">American Independent</td>
<td>1968</td>
<td>George Wallace</td>
<td>9901118</td>
<td>loss</td>
<td>13.571218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Anti-Masonic</td>
<td>1832</td>
<td>William Wirt</td>
<td>100715</td>
<td>loss</td>
<td>7.821583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Anti-Monopoly</td>
<td>1884</td>
<td>Benjamin Butler</td>
<td>134294</td>
<td>loss</td>
<td>1.335838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Citizens</td>
<td>1980</td>
<td>Barry Commoner</td>
<td>233052</td>
<td>loss</td>
<td>0.270182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Communist</td>
<td>1932</td>
<td>William Z. Foster</td>
<td>103307</td>
<td>loss</td>
<td>0.261069</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Constitution</td>
<td>2008</td>
<td>Chuck Baldwin</td>
<td>199750</td>
<td>loss</td>
<td>0.152398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Constitutional Union</td>
<td>1860</td>
<td>John Bell</td>
<td>590901</td>
<td>loss</td>
<td>12.639283</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Democratic</td>
<td>1964</td>
<td>Lyndon Johnson</td>
<td>43127041</td>
<td>win</td>
<td>61.344703</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Democratic-Republican</td>
<td>1824</td>
<td>Andrew Jackson</td>
<td>151271</td>
<td>loss</td>
<td>57.210122</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here’s an illustration of the process:</p>
<center>
<img src="../assets/puzzle_demo.png" alt="first" width="100%" style="filter:invert(1)">
</center>
<p>Notice how our code correctly determines that Lyndon Johnson from the Democratic Party has the highest voter <code>%</code>.</p>
<p>More generally, <code>lambda</code> functions are used to design custom aggregation functions that aren’t pre-defined by Python. The input parameter <code>x</code> to the <code>lambda</code> function is a <code>GroupBy</code> object. Therefore, it should make sense why <code>lambda x : x.iloc[0]</code> selects the first row in each groupby object.</p>
<p>In fact, there’s a few different ways to approach this problem. Each approach has different tradeoffs in terms of readability, performance, memory consumption, complexity, etc. We’ve given a few examples below.</p>
<p><strong>Note</strong>: Understanding these alternative solutions is not required. They are given to demonstrate the vast number of problem-solving approaches in <code>pandas</code>.</p>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the idxmax function</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>best_per_party <span class="op">=</span> elections.loc[elections.groupby(<span class="st">'Party'</span>)[<span class="st">'%'</span>].idxmax()]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>best_per_party.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>1856</td>
<td>Millard Fillmore</td>
<td>American</td>
<td>873053</td>
<td>loss</td>
<td>21.554001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">115</td>
<td>1968</td>
<td>George Wallace</td>
<td>American Independent</td>
<td>9901118</td>
<td>loss</td>
<td>13.571218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1832</td>
<td>William Wirt</td>
<td>Anti-Masonic</td>
<td>100715</td>
<td>loss</td>
<td>7.821583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>1884</td>
<td>Benjamin Butler</td>
<td>Anti-Monopoly</td>
<td>134294</td>
<td>loss</td>
<td>1.335838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">127</td>
<td>1980</td>
<td>Barry Commoner</td>
<td>Citizens</td>
<td>233052</td>
<td>loss</td>
<td>0.270182</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the .drop_duplicates function</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>best_per_party2 <span class="op">=</span> elections.sort_values(<span class="st">'%'</span>).drop_duplicates([<span class="st">'Party'</span>], keep<span class="op">=</span><span class="st">'last'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>best_per_party2.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">148</td>
<td>1996</td>
<td>John Hagelin</td>
<td>Natural Law</td>
<td>113670</td>
<td>loss</td>
<td>0.118219</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">164</td>
<td>2008</td>
<td>Chuck Baldwin</td>
<td>Constitution</td>
<td>199750</td>
<td>loss</td>
<td>0.152398</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110</td>
<td>1956</td>
<td>T. Coleman Andrews</td>
<td>States' Rights</td>
<td>107929</td>
<td>loss</td>
<td>0.174883</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">147</td>
<td>1996</td>
<td>Howard Phillips</td>
<td>Taxpayers</td>
<td>184656</td>
<td>loss</td>
<td>0.192045</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">136</td>
<td>1988</td>
<td>Lenora Fulani</td>
<td>New Alliance</td>
<td>217221</td>
<td>loss</td>
<td>0.237804</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="other-groupby-features" class="level3">
<h3 class="anchored" data-anchor-id="other-groupby-features">Other <code>GroupBy</code> Features</h3>
<p>There are many aggregation methods we can use with <code>.agg</code>. Some useful options are:</p>
<ul>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.mean.html#pandas.core.groupby.DataFrameGroupBy.mean"><code>.mean</code></a>: creates a new DataFrame with the mean value of each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.sum.html#pandas.core.groupby.DataFrameGroupBy.sum"><code>.sum</code></a>: creates a new DataFrame with the sum of each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.max.html#pandas.core.groupby.DataFrameGroupBy.max"><code>.max</code></a> and <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.min.html#pandas.core.groupby.DataFrameGroupBy.min"><code>.min</code></a>: creates a new DataFrame with the maximum/minimum value of each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.first.html#pandas.core.groupby.DataFrameGroupBy.first"><code>.first</code></a> and <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.last.html#pandas.core.groupby.DataFrameGroupBy.last"><code>.last</code></a>: creates a new DataFrame with the first/last row in each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.size.html#pandas.core.groupby.DataFrameGroupBy.size"><code>.size</code></a>: creates a new <strong>Series</strong> with the number of entries in each group</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.count.html#pandas.core.groupby.DataFrameGroupBy.count"><code>.count</code></a>: creates a new <strong>DataFrame</strong> with the number of entries, excluding missing values.</li>
</ul>
<p>Note the slight difference between <code>.size()</code> and <code>.count()</code>: while <code>.size()</code> returns a Series and counts the number of entries including the missing values, <code>.count()</code> returns a DataFrame and counts the number of entries in each column excluding missing values. Here’s an example:</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'letter'</span>:[<span class="st">'A'</span>,<span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>,<span class="st">'C'</span>], </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'num'</span>:[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="va">None</span>,<span class="dv">4</span>], </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'state'</span>:[<span class="va">None</span>, <span class="st">'tx'</span>, <span class="st">'fl'</span>, <span class="st">'hi'</span>, <span class="va">None</span>, <span class="st">'ak'</span>]})</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">letter</th>
<th data-quarto-table-cell-role="th">num</th>
<th data-quarto-table-cell-role="th">state</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>A</td>
<td>1.0</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>A</td>
<td>2.0</td>
<td>tx</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>B</td>
<td>3.0</td>
<td>fl</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>C</td>
<td>4.0</td>
<td>hi</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>C</td>
<td>NaN</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>C</td>
<td>4.0</td>
<td>ak</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-34" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"letter"</span>).size()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>letter
A    2
B    1
C    3
dtype: int64</code></pre>
</div>
</div>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"letter"</span>).count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">num</th>
<th data-quarto-table-cell-role="th">state</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">letter</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">A</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">B</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">C</td>
<td>2</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You might recall that the <code>value_counts()</code> function in the previous note does something similar. It turns out <code>value_counts()</code> and <code>groupby.size()</code> are the same, except <code>value_counts()</code> sorts the resulting Series in descending order automatically.</p>
<div id="cell-37" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"letter"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>C    3
A    2
B    1
Name: letter, dtype: int64</code></pre>
</div>
</div>
<p>hese (and other) aggregation functions are so common that <code>pandas</code> allows for writing shorthand. Instead of explicitly stating the use of <code>.agg</code>, we can call the function directly on the <code>GroupBy</code> object.</p>
<p>For example, the following are equivalent:</p>
<ul>
<li><code>elections.groupby("Candidate").agg(mean)</code></li>
<li><code>elections.groupby("Candidate").mean()</code></li>
</ul>
<p>There are many other methods that <code>pandas</code> supports. You can check them out on the <a href="https://pandas.pydata.org/docs/reference/groupby.html"><code>pandas</code> documentation</a>.</p>
<p><br></p>
<center>
<img src="../assets/groupby_2.png" alt="first" width="100%" style="filter:invert(1)">
</center>
</section>
<section id="filtering-by-group" class="level3">
<h3 class="anchored" data-anchor-id="filtering-by-group">Filtering by Group</h3>
<p>Another common use for <code>GroupBy</code> objects is to filter data by group.</p>
<p><code>groupby.filter</code> takes an argument <span class="math inline">\(\text{f}\)</span>, where <span class="math inline">\(\text{f}\)</span> is a function that:</p>
<ul>
<li>Takes a DataFrame object as input</li>
<li>Returns a single <code>True</code> or <code>False</code> for the each sub-DataFrame</li>
</ul>
<p>Sub-DataFrames that correspond to <code>True</code> are returned in the final result, whereas those with a <code>False</code> value are not. Importantly, <code>groupby.filter</code> is different from <code>groupby.agg</code> in that an <em>entire</em> sub-DataFrame is returned in the final DataFrame, not just a single row. As a result, <code>groupby.filter</code> preserves the original indices.</p>
<p>To illustrate how this happens, consider the following <code>.filter</code> function applied on some arbitrary data. Say we want to identify “tight” election years – that is, we want to find all rows that correspond to elections years where all candidates in that year won a similar portion of the total vote. Specifically, let’s find all rows corresponding to a year where no candidate won more than 45% of the total vote.</p>
<p>In other words, we want to:</p>
<ul>
<li>Find the years where the maximum <code>%</code> in that year is less than 45%</li>
<li>Return all DataFrame rows that correspond to these years</li>
</ul>
<p>For each year, we need to find the maximum <code>%</code> among <em>all</em> rows for that year. If this maximum <code>%</code> is lower than 45%, we will tell <code>pandas</code> to keep all rows corresponding to that year.</p>
<div id="cell-39" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>elections.groupby(<span class="st">"Year"</span>).<span class="bu">filter</span>(<span class="kw">lambda</span> sf: sf[<span class="st">"%"</span>].<span class="bu">max</span>() <span class="op">&lt;</span> <span class="dv">45</span>).head(<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Candidate</th>
<th data-quarto-table-cell-role="th">Party</th>
<th data-quarto-table-cell-role="th">Popular vote</th>
<th data-quarto-table-cell-role="th">Result</th>
<th data-quarto-table-cell-role="th">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>1860</td>
<td>Abraham Lincoln</td>
<td>Republican</td>
<td>1855993</td>
<td>win</td>
<td>39.699408</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>1860</td>
<td>John Bell</td>
<td>Constitutional Union</td>
<td>590901</td>
<td>loss</td>
<td>12.639283</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>1860</td>
<td>John C. Breckinridge</td>
<td>Southern Democratic</td>
<td>848019</td>
<td>loss</td>
<td>18.138998</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>1860</td>
<td>Stephen A. Douglas</td>
<td>Northern Democratic</td>
<td>1380202</td>
<td>loss</td>
<td>29.522311</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>1912</td>
<td>Eugene V. Debs</td>
<td>Socialist</td>
<td>901551</td>
<td>loss</td>
<td>6.004354</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">67</td>
<td>1912</td>
<td>Eugene W. Chafin</td>
<td>Prohibition</td>
<td>208156</td>
<td>loss</td>
<td>1.386325</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">68</td>
<td>1912</td>
<td>Theodore Roosevelt</td>
<td>Progressive</td>
<td>4122721</td>
<td>loss</td>
<td>27.457433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">69</td>
<td>1912</td>
<td>William Taft</td>
<td>Republican</td>
<td>3486242</td>
<td>loss</td>
<td>23.218466</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">70</td>
<td>1912</td>
<td>Woodrow Wilson</td>
<td>Democratic</td>
<td>6296284</td>
<td>win</td>
<td>41.933422</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What’s going on here? In this example, we’ve defined our filtering function, <span class="math inline">\(\text{f}\)</span>, to be <code>lambda sf: sf["%"].max() &lt; 45</code>. This filtering function will find the maximum <code>"%"</code> value among all entries in the grouped sub-DataFrame, which we call <code>sf</code>. If the maximum value is less than 45, then the filter function will return <code>True</code> and all rows in that grouped sub-DataFrame will appear in the final output DataFrame.</p>
<p>Examine the DataFrame above. Notice how, in this preview of the first 9 rows, all entries from the years 1860 and 1912 appear. This means that in 1860 and 1912, no candidate in that year won more than 45% of the total vote.</p>
<p>You may ask: how is the <code>groupby.filter</code> procedure different to the boolean filtering we’ve seen previously? Boolean filtering considers <em>individual</em> rows when applying a boolean condition. For example, the code <code>elections[elections["%"] &lt; 45]</code> will check the <code>"%"</code> value of every single row in <code>elections</code>; if it is less than 45, then that row will be kept in the output. <code>groupby.filter</code>, in contrast, applies a boolean condition <em>across</em> all rows in a group. If not all rows in that group satisfy the condition specified by the filter, the entire group will be discarded in the output.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>